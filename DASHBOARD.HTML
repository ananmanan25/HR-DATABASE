<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Executive | Unified Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
                /* Ensure link-based nav items match button styles */
a.nav-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    transition: 0.2s ease-in-out;
}

/* Specific styling for the external icon */
.nav-link .fa-external-link-alt {
    transition: transform 0.3s;
}

.nav-link:hover .fa-external-link-alt {
    transform: translate(2px, -2px);
    opacity: 1;
    color: var(--neon-green);
}
        /* --- Intelligence Hub Mobile Optimization --- */
@media (max-width: 768px) {
    body {
        flex-direction: column;
        overflow-y: auto;
    }

    /* 1. Transform Sidebar to Bottom Sticky Bar */
    aside {
        width: 100%;
        height: 70px;
        position: fixed;
        bottom: 0;
        left: 0;
        flex-direction: row;
        padding: 0 15px;
        background: rgba(1, 4, 9, 0.98);
        border-right: none;
        border-top: 1px solid var(--border);
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
    }

    aside div:first-child, /* Logo hide */
    aside div:last-child { /* Currency toggle hide or reposition */
        display: none; 
    }

    aside nav {
        display: flex;
        flex-direction: row;
        width: 100%;
        justify-content: space-around;
    }

    .nav-link {
        flex-direction: column;
        gap: 5px;
        font-size: 0.65rem;
        padding: 10px;
        margin: 0;
        border: none;
    }

    .nav-link i { font-size: 1.2rem; }

    /* 2. Content Spacing */
    main {
        padding: 20px;
        padding-bottom: 100px; /* Space for bottom nav */
    }

    header {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 15px;
    }

    /* 3. Stats Grid: 2x2 Layout */
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .stat-card {
        padding: 15px;
    }

    .stat-card .val {
        font-size: 1.1rem;
    }

    /* 4. Priority Layout: Move ROI Gauge above Chart */
    #reports > div[style*="grid-template-columns"] {
        display: flex !important;
        flex-direction: column-reverse; /* Gauge first, then Chart */
        gap: 20px;
    }

    #roi-gauge {
        font-size: 2.8rem;
    }

    /* 5. Chart Adjustment */
    .chart-container {
        height: 250px;
    }

    /* 6. Table Accessibility */
    .glass-card {
        overflow-x: auto;
        padding: 15px;
    }

    table {
        min-width: 550px; /* Forces scroll instead of squishing text */
    }
    
    td, th {
        padding: 10px;
        font-size: 0.75rem;
    }
}

/* Extra Small Devices */
@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr; /* Single column for very narrow phones */
    }
    
    h1 { font-size: 1.5rem !important; }
}
        :root {
            --bg: #020408;
            --card: rgba(13, 17, 23, 0.8);
            --border: rgba(48, 54, 61, 0.8);
            --neon-green: #38f838;
            --cyber-blue: #58a6ff;
            --gold: #f1c40f;
            --text-main: #e6edf3;
            --text-dim: #8b949e;
        }

        * { box-sizing: border-box; transition: all 0.25s ease; }
        body {
            background-color: var(--bg);
            background-image: radial-gradient(circle at 50% 0%, #0d1117 0%, #020408 100%);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        /* --- SIDEBAR --- */
        aside {
            width: 260px; background: #010409; border-right: 1px solid var(--border);
            padding: 30px 20px; display: flex; flex-direction: column; z-index: 100;
        }

        .nav-link {
            padding: 12px; color: var(--text-dim); border-radius: 12px; margin-bottom: 8px;
            cursor: pointer; border: 1px solid transparent; background: none;
            text-align: left; display: flex; align-items: center; gap: 12px; font-size: 0.9rem;
        }
        .nav-link.active { background: rgba(56, 248, 56, 0.1); color: var(--neon-green); border-color: var(--neon-green); font-weight: 700; }

        /* --- MAIN VIEW --- */
        main { flex: 1; overflow-y: auto; padding: 40px; }
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- REPORT CARDS --- */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card {
            background: var(--card); border: 1px solid var(--border); padding: 20px;
            border-radius: 18px; position: relative;
        }
        .stat-card h4 { margin: 0; font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }
        .stat-card .val { font-size: 1.5rem; font-weight: 800; margin-top: 8px; font-family: 'JetBrains Mono'; }

        /* --- CHARTS & TABLES --- */
        .glass-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 24px; backdrop-filter: blur(10px); margin-bottom: 20px; }
        .chart-container { height: 300px; position: relative; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { text-align: left; padding: 12px; color: var(--text-dim); font-size: 0.7rem; text-transform: uppercase; }
        td { background: rgba(255,255,255,0.02); padding: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        td:first-child { border-radius: 12px 0 0 12px; border-left: 1px solid var(--border); }
        td:last-child { border-radius: 0 12px 12px 0; border-right: 1px solid var(--border); }

        .btn { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 0.8rem; }
        .btn-p { background: var(--neon-green); color: #000; }
        
        #currency-label { font-size: 0.65rem; color: var(--neon-green); font-weight: 800; letter-spacing: 1px; }
    </style>
</head>
<body>
 
<aside>
    <div style="font-size: 1.4rem; font-weight: 900; color: var(--neon-green); margin-bottom: 40px; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-microchip"></i> QUANTUM
    </div>
    
    <nav style="flex: 1;">
        <button class="nav-link active" onclick="showSection('reports', this)"><i class="fas fa-chart-line"></i> Intelligence</button>
        <button class="nav-link" onclick="showSection('inventory', this)"><i class="fas fa-boxes"></i> Stock Matrix</button>
        <button class="nav-link" onclick="showSection('partners', this)"><i class="fas fa-user-friends"></i> Investor Hub</button>
    </nav>

    <div style="padding: 15px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
        <div id="currency-label">SYSTEM CURRENCY</div>
        <div style="display:flex; align-items:center; justify-content:space-between; margin-top:10px;">
            <span style="font-size:0.8rem; font-weight:700;">LKR / USD</span>
            <input type="checkbox" id="curr-toggle" onchange="refreshAll()" style="width: auto; cursor: pointer;">
        </div>
    </div>
    <a href="ins.html" target="_blank" class="nav-link" style="text-decoration: none; border-top: 1px solid rgba(255,255,255,0.05); margin-top: 10px; padding-top: 15px;">
    <i class="fas fa-chart-line" style="color: var(--accent);"></i> 
    <span>Investor pitch</span>
    <i class="fas fa-external-link-alt" style="font-size: 0.6rem; margin-left: auto; opacity: 0.5;"></i>
</a>

<a href="DASHBOARD.HTML" target="_blank" class="nav-link" style="text-decoration: none;">
    <i class="fas fa-globe" style="color: var(--warning);"></i> 
    <span>Analizes</span>
    <i class="fas fa-external-link-alt" style="font-size: 0.6rem; margin-left: auto; opacity: 0.5;"></i>
</a>
</aside>

<main>
    <header style="margin-bottom: 40px; display:flex; justify-content:space-between; align-items:flex-end;">
        <div>
            <h1 style="margin:0; font-size: 2rem;">Executive Dashboard</h1>
            <p style="color: var(--text-dim); margin: 5px 0 0 0;">Unified Reports from Inventory & Investor Modules.</p>
        </div>
        <div style="text-align:right">
            <div id="live-time" style="font-family:'JetBrains Mono'; color:var(--neon-green)">00:00:00</div>
            <div style="font-size:0.6rem; color:var(--text-dim)">NEXUS-V3 ACTIVE</div>
        </div>
    </header>

    <div id="reports" class="page-section active">
        <div class="stats-grid">
            <div class="stat-card" style="border-left: 4px solid var(--cyber-blue);">
                <h4>Net Asset Value</h4>
                <div class="val" id="rep-net">0</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid var(--neon-green);">
                <h4>Realized Margin</h4>
                <div class="val" id="rep-profit">0</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid var(--gold);">
                <h4>Partner Equity</h4>
                <div class="val" id="rep-equity">0</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #ff4d4d;">
                <h4>Stock Valuation</h4>
                <div class="val" id="rep-stock-val">0</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <div class="glass-card">
                <h3>Asset & Equity Distribution</h3>
                <div class="chart-container"><canvas id="mainChart"></canvas></div>
            </div>
            <div class="glass-card" style="display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
                <div id="roi-gauge" style="font-size: 3.5rem; color: var(--neon-green); font-weight: 800;">0%</div>
                <p style="color:var(--text-dim)">Capital Efficiency ROI</p>
                <div style="margin-top:20px; width:100%; height:8px; background:#222; border-radius:10px; overflow:hidden;">
                    <div id="roi-bar" style="height:100%; background:var(--neon-green); width:0%;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="inventory" class="page-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3>Inventory Matrix</h3>
            <button class="btn btn-p" onclick="alert('Use Add Asset in Original Index')">Stock Summary</button>
        </div>
        <div class="glass-card">
            <table>
                <thead><tr><th>Asset Name</th><th>Config</th><th>Cost</th><th>Stock</th><th>Status</th></tr></thead>
                <tbody id="stock-table"></tbody>
            </table>
        </div>
    </div>

    <div id="partners" class="page-section">
        <h3>Investor Distribution</h3>
        <div class="glass-card">
            <table>
                <thead><tr><th>Entity</th><th>Asset</th><th>Stake</th><th>Capital</th><th>ROI Target</th><th>Paid</th></tr></thead>
                <tbody id="investor-table"></tbody>
            </table>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA3xSzrOvFFMkPDtxfKQRPBwXfpa2sejKg",
        authDomain: "accountent-a4317.firebaseapp.com",
        projectId: "accountent-a4317",
        storageBucket: "accountent-a4317.firebasestorage.app",
        messagingSenderId: "708334116507",
        appId: "1:708334116507:web:3028235fb8e68f26a5f03e",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let state = { products: [], investors: [], salesProfit: 0, totalCapital: 0 };
    let chart = null;

    // --- VIEW CONTROLLER ---
    window.showSection = (id, btn) => {
        document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    };

    // --- DATA REFRESH & REPORTING ---
    window.refreshAll = () => {
        const isUSD = document.getElementById('curr-toggle').checked;
        const rate = isUSD ? 310 : 1;
        const sym = isUSD ? "$" : "Rs. ";
        const f = (n) => sym + (n/rate).toLocaleString(undefined, {maximumFractionDigits: isUSD ? 2 : 0});

        let stockVal = state.products.reduce((acc, p) => acc + (p.qty * p.landedCost), 0);
        let investorCap = state.investors.reduce((acc, i) => acc + i.amount, 0);
        let totalPaidOut = state.investors.reduce((acc, i) => acc + (i.totalPaid || 0), 0);
        
        // Report Calculations
        document.getElementById('rep-net').innerText = f(stockVal + state.salesProfit);
        document.getElementById('rep-profit').innerText = f(state.salesProfit);
        document.getElementById('rep-equity').innerText = f(investorCap);
        document.getElementById('rep-stock-val').innerText = f(stockVal);

        const roi = investorCap > 0 ? ((state.salesProfit / investorCap) * 100).toFixed(1) : 0;
        document.getElementById('roi-gauge').innerText = roi + "%";
        document.getElementById('roi-bar').style.width = Math.min(roi, 100) + "%";

        renderChart();
    };

    function renderChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: state.products.map(p => p.name),
                datasets: [{
                    label: 'Units in Stock',
                    data: state.products.map(p => p.qty),
                    backgroundColor: '#38f838', borderRadius: 8
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    // --- REAL-TIME LISTENERS ---
    onSnapshot(collection(db, "products"), (snap) => {
        state.products = []; let h = "";
        snap.forEach(d => {
            const p = d.data(); state.products.push(p);
            h += `<tr><td><b>${p.name}</b></td><td>${Object.keys(p.variants).length} Variants</td><td>${p.landedCost}</td><td>${p.qty}</td><td><span style="color:${p.qty < 5 ? '#ff4d4d' : '#38f838'}">${p.qty < 5 ? 'LOW' : 'OK'}</span></td></tr>`;
        });
        document.getElementById('stock-table').innerHTML = h;
        refreshAll();
    });

    onSnapshot(collection(db, "investors"), (snap) => {
        state.investors = []; let h = "";
        snap.forEach(d => {
            const i = d.data(); state.investors.push(i);
            const target = i.amount * (i.equity/100);
            h += `<tr><td>${i.name}</td><td>${i.productName}</td><td>${i.equity}%</td><td>${i.amount}</td><td>${target}</td><td style="color:var(--gold)">${i.totalPaid || 0}</td></tr>`;
        });
        document.getElementById('investor-table').innerHTML = h;
        refreshAll();
    });

    onSnapshot(collection(db, "sales"), snap => {
        state.salesProfit = 0;
        snap.forEach(d => state.salesProfit += d.data().profit);
        refreshAll();
    });

    setInterval(() => { document.getElementById('live-time').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>