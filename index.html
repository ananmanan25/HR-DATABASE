<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceelon Pro | Executive Fashion Suite</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar: #000000; --bg: #f8fafc; --accent: #51f63b; 
            --success: #10b981; --danger: #ef4444; --text-main: #1e293b;
        }
        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; flex-direction: row; }

        /* Sidebar */
        aside { width: 280px; background: var(--sidebar); color: white; display: flex; flex-direction: column; padding: 1.5rem; flex-shrink: 0; }
        .brand { font-size: 1.6rem; font-weight: 800; color: #38f838; margin-bottom: 2.5rem; display: flex; align-items: center; gap: 12px; }
        .nav-link { padding: 12px 16px; color: #94a3b8; border-radius: 10px; margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.3s; border: none; background: none; width: 100%; text-align: left; font-size: 1rem; }
        .nav-link:hover { background: #1e293b; color: white; }
        .nav-link.active { border-left: 4px solid #3ef838; background: #1e293b; color: white; }

        /* Main Area */
        main { flex: 1; overflow-y: auto; padding: 2rem; }
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 16px; border: 1px solid #e2e8f0; }
        .stat-card h4 { margin: 0; color: #64748b; font-size: 0.75rem; text-transform: uppercase; }
        .stat-card .val { font-size: 1.5rem; font-weight: 800; margin-top: 8px; }

        .glass-card { background: white; border-radius: 16px; padding: 1.5rem; border: 1px solid #e2e8f0; margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f8fafc; color: #64748b; font-size: 0.75rem; border-bottom: 2px solid #f1f5f9; }
        td { padding: 10px 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; }
        
        input.inline-edit { width: 100%; border: 1px solid transparent; padding: 5px; border-radius: 4px; background: transparent; transition: 0.2s; }
        input.inline-edit:hover { border-color: #e2e8f0; background: #fff; }
        input.inline-edit:focus { outline: none; border-color: var(--accent); background: #fff; box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1); }
        
        .btn { border: none; padding: 8px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-p { background: var(--accent); color: white; }
        .btn-d { background: var(--danger); color: white; }
        .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(34, 44, 66, 0.7); z-index:1000; justify-content:center; align-items:center; backdrop-filter: blur(4px); }

        /* --- LOGIN SCREEN STYLE --- */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--sidebar); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-box { background: white; padding: 2.5rem; border-radius: 20px; width: 350px; text-align: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #e2e8f0; border-radius: 8px; }
        #app-container { display: none; width: 100%; height: 100vh; }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; }
            #app-container { flex-direction: column; }
            aside { width: 100%; height: auto; padding: 1rem; flex-direction: row; overflow-x: auto; position: sticky; top: 0; z-index: 1001; }
            .brand { margin-bottom: 0; margin-right: 20px; font-size: 1.2rem; }
            .nav-link { margin-bottom: 0; margin-right: 10px; white-space: nowrap; padding: 8px 12px; font-size: 0.85rem; }
            main { padding: 1rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .stat-card .val { font-size: 1.1rem; }
            .glass-card { padding: 10px; overflow-x: auto; }
            table { min-width: 600px; }
            .top-bar { flex-direction: column; align-items: flex-start; gap: 10px; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <div class="brand" style="justify-content: center; color: var(--sidebar); margin-bottom: 1rem;">
            <i class="fas fa-gem"></i> Welcome Maleesha</div>
            
        <p style="color: #64748b; margin-bottom: 1.5rem;">pass word eka dipn nikn yna ba/class wara kanna ymn</p>
        <input type="text" id="user-input" placeholder="Username">
        <input type="password" id="pass-input" placeholder="Password">
        <button class="btn btn-p" onclick="checkLogin()" style="width: 100%; margin-top: 10px; justify-content: center;">Access Suite</button>
        <p id="login-err" style="color: var(--danger); font-size: 0.8rem; margin-top: 10px; display: none;">Invalid Credentials</p>
    </div>
</div>

<div id="app-container">
    <aside>
        <div class="brand"><i class="fas fa-gem"></i> Ananmanan</div>
        <button class="nav-link active" onclick="showSection('dashboard', this)"><i class="fas fa-chart-line"></i> Dashboard</button>
        <button class="nav-link" onclick="showSection('inventory', this)"><i class="fas fa-boxes"></i> Products</button>
        <button class="nav-link" onclick="showSection('sales', this)"><i class="fas fa-shopping-cart"></i> Sales Ledger</button>
        <button class="nav-link" onclick="showSection('expenses', this)"><i class="fas fa-wallet"></i> Expenses</button>
        <button class="nav-link" onclick="showSection('payroll', this)"><i class="fas fa-users"></i> Staff & Payroll</button>
        <button class="nav-link" style="margin-top: auto; color: #ef4444;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </aside>

    <main>
        <div id="dashboard" class="page-section active">
            <div class="top-bar"><h1>Executive Overview</h1><button class="btn btn-p" onclick="updateCapital()">Update Capital</button></div>
            <div class="stats-grid">
                <div class="stat-card"><h4>Net Worth</h4><div class="val" id="dash-net-worth">Rs. 0</div></div>
                <div class="stat-card"><h4>Sales Profit</h4><div class="val" id="dash-total-profit">Rs. 0</div></div>
                <div class="stat-card"><h4>Total Expenses</h4><div class="val" id="dash-total-expenses">Rs. 0</div></div>
                <div class="stat-card"><h4>Stock Asset</h4><div class="val" id="dash-stock-value">Rs. 0</div></div>
            </div>
            <div class="glass-card"><h3 id="dash-cash-flow">Cash Balance: Rs. 0</h3></div>
        </div>

        <div id="inventory" class="page-section">
            <div class="top-bar"><h1>Inventory</h1><button class="btn btn-p" onclick="addNewStyle()">Add Products</button></div>
            <div class="glass-card">
                <table><thead><tr><th>Style Name</th><th>Qty</th><th>Landed Cost</th><th>Retail Price</th><th>Actions</th></tr></thead>
                <tbody id="product-list"></tbody></table>
            </div>
        </div>

        <div id="sales" class="page-section">
            <div class="top-bar"><h1>Sales Ledger</h1><button class="btn btn-p" onclick="openSaleModal()">Record Sale</button></div>
            <div class="glass-card">
                <table><thead><tr><th>Date</th><th>Item</th><th>Qty</th><th>Sale Price</th><th>Profit</th><th>Actions</th></tr></thead>
                <tbody id="sales-list"></tbody></table>
            </div>
        </div>

        <div id="expenses" class="page-section">
            <div class="top-bar"><h1>Expenses</h1><button class="btn btn-d" onclick="openExpenseModal()">Log Expense</button></div>
            <div class="glass-card">
                <table><thead><tr><th>Date</th><th>Category</th><th>Note</th><th>Amount</th><th>Actions</th></tr></thead>
                <tbody id="expense-list"></tbody></table>
            </div>
        </div>

        <div id="payroll" class="page-section">
            <div class="top-bar"><h1>Staff</h1><button class="btn btn-p" onclick="openStaffModal()">Add Staff</button></div>
            <div class="glass-card">
                <table><thead><tr><th>Name</th><th>Role</th><th>Salary</th><th>Actions</th></tr></thead>
                <tbody id="staff-list"></tbody></table>
            </div>
        </div>
    </main>
</div>

<div id="sales-modal" class="modal-overlay"><div class="glass-card" style="width:350px;"><h2>Sale</h2><select id="sale-product-select" class="inline-edit" style="border:1px solid #ccc; margin-bottom:10px;"></select><input type="number" id="sale-qty" class="inline-edit" placeholder="Qty" value="1" style="border:1px solid #ccc;"><input type="number" id="sale-price" class="inline-edit" placeholder="Price" style="border:1px solid #ccc;"><br><br><button class="btn btn-p" onclick="processSale()">Save Sale</button><button onclick="closeModal('sales-modal')">Cancel</button></div></div>
<div id="expense-modal" class="modal-overlay"><div class="glass-card" style="width:350px;"><h2>Expense</h2><input id="exp-cat" class="inline-edit" placeholder="Category" style="border:1px solid #ccc;"><input type="number" id="exp-amt" class="inline-edit" placeholder="Amount" style="border:1px solid #ccc;"><input type="text" id="exp-note" class="inline-edit" placeholder="Note" style="border:1px solid #ccc;"><br><br><button class="btn btn-d" onclick="saveExpense()">Save Expense</button><button onclick="closeModal('expense-modal')">Cancel</button></div></div>
<div id="staff-modal" class="modal-overlay"><div class="glass-card" style="width:350px;"><h2>Staff</h2><input type="text" id="staff-name" class="inline-edit" placeholder="Name" style="border:1px solid #ccc;"><input type="text" id="staff-role" class="inline-edit" placeholder="Role" style="border:1px solid #ccc;"><input type="number" id="staff-salary" class="inline-edit" placeholder="Salary" style="border:1px solid #ccc;"><br><br><button class="btn btn-p" onclick="saveStaff()">Save Staff</button><button onclick="closeModal('staff-modal')">Cancel</button></div></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc, addDoc, deleteDoc, getDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA3xSzrOvFFMkPDtxfKQRPBwXfpa2sejKg",
        authDomain: "accountent-a4317.firebaseapp.com",
        projectId: "accountent-a4317",
        storageBucket: "accountent-a4317.firebasestorage.app",
        messagingSenderId: "708334116507",
        appId: "1:708334116507:web:3028235fb8e68f26a5f03e",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global Functions for Buttons
    window.deleteDoc = deleteDoc;
    window.doc = doc;
    window.db = db;

    let totals = { capital: 0, salesProfit: 0, expenses: 0, stockValue: 0 };

    function refreshDashboard() {
        const netCash = totals.salesProfit - totals.expenses;
        const netWorth = totals.capital + netCash + totals.stockValue;
        document.getElementById('dash-net-worth').innerText = "Rs. " + netWorth.toLocaleString();
        document.getElementById('dash-total-profit').innerText = "Rs. " + totals.salesProfit.toLocaleString();
        document.getElementById('dash-total-expenses').innerText = "Rs. " + totals.expenses.toLocaleString();
        document.getElementById('dash-stock-value').innerText = "Rs. " + totals.stockValue.toLocaleString();
        document.getElementById('dash-cash-flow').innerText = "Cash Balance: Rs. " + netCash.toLocaleString();
    }

    window.showSection = (id, btn) => {
        document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    };
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';
    window.dbUpdate = async (coll, id, field, val) => { await updateDoc(doc(db, coll, id), { [field]: isNaN(val) ? val : Number(val) }); };

    // AUTH LOGIC
    window.checkLogin = () => {
        const user = document.getElementById('user-input').value;
        const pass = document.getElementById('pass-input').value;
        if(user === "welcome" && pass === "911") {
            sessionStorage.setItem("ceelon_auth", "true");
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
        } else {
            document.getElementById('login-err').style.display = 'block';
        }
    };
    window.logout = () => { sessionStorage.removeItem("ceelon_auth"); location.reload(); };

    // FINANCES
    onSnapshot(doc(db, "finances", "main"), (snap) => { if(snap.exists()){ totals.capital = snap.data().capital || 0; refreshDashboard(); } });
    window.updateCapital = async () => { const v = prompt("Enter Capital:", totals.capital); if(v) await updateDoc(doc(db, "finances", "main"), { capital: Number(v) }); };

    // INVENTORY
    onSnapshot(collection(db, "products"), (snap) => {
        const list = document.getElementById('product-list');
        const sel = document.getElementById('sale-product-select');
        let sv = 0; list.innerHTML = ""; sel.innerHTML = "";
        snap.forEach(d => {
            const p = d.data(); sv += (p.qty * p.landedCost);
            list.innerHTML += `<tr>
                <td><input class="inline-edit" value="${p.name}" onchange="dbUpdate('products','${d.id}','name',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${p.qty}" onchange="dbUpdate('products','${d.id}','qty',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${p.landedCost}" onchange="dbUpdate('products','${d.id}','landedCost',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${p.retailPrice}" onchange="dbUpdate('products','${d.id}','retailPrice',this.value)"></td>
                <td><button onclick="deleteDoc(doc(db,'products','${d.id}'))">üóëÔ∏è</button></td></tr>`;
            sel.innerHTML += `<option value="${d.id}">${p.name}</option>`;
        });
        totals.stockValue = sv; refreshDashboard();
    });
    window.addNewStyle = async () => { const n = prompt("Style Name:"); if(n) await addDoc(collection(db,"products"), {name:n, qty:0, landedCost:0, retailPrice:0}); };

    // SALES
    window.openSaleModal = () => document.getElementById('sales-modal').style.display = 'flex';
    window.processSale = async () => {
        const id = document.getElementById('sale-product-select').value;
        const q = Number(document.getElementById('sale-qty').value);
        const p = Number(document.getElementById('sale-price').value);
        const pDoc = await getDoc(doc(db, "products", id));
        const pData = pDoc.data();
        await addDoc(collection(db, "sales"), { name: pData.name, qty: q, salePrice: p, landedCost: pData.landedCost, profit: (p - pData.landedCost) * q, date: new Date() });
        await updateDoc(doc(db, "products", id), { qty: pData.qty - q });
        closeModal('sales-modal');
    };
    onSnapshot(query(collection(db, "sales"), orderBy("date", "desc")), (snap) => {
        let sp = 0; const l = document.getElementById('sales-list'); l.innerHTML = "";
        snap.forEach(d => {
            const s = d.data(); sp += s.profit;
            l.innerHTML += `<tr>
                <td>${s.date?.toDate().toLocaleDateString()}</td>
                <td><input class="inline-edit" value="${s.name}" onchange="dbUpdate('sales','${d.id}','name',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${s.qty}" onchange="dbUpdate('sales','${d.id}','qty',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${s.salePrice}" onchange="dbUpdate('sales','${d.id}','salePrice',this.value)"></td>
                <td style="color:var(--success)">${s.profit}</td>
                <td><button onclick="deleteDoc(doc(db,'sales','${d.id}'))">üóëÔ∏è</button></td></tr>`;
        });
        totals.salesProfit = sp; refreshDashboard();
    });

    // EXPENSES
    window.openExpenseModal = () => document.getElementById('expense-modal').style.display = 'flex';
    window.saveExpense = async () => {
        await addDoc(collection(db, "expenses"), { category: document.getElementById('exp-cat').value, amount: Number(document.getElementById('exp-amt').value), note: document.getElementById('exp-note').value, date: new Date() });
        closeModal('expense-modal');
    };
    onSnapshot(collection(db, "expenses"), (snap) => {
        let ex = 0; const l = document.getElementById('expense-list'); l.innerHTML = "";
        snap.forEach(d => {
            const e = d.data(); ex += e.amount;
            l.innerHTML += `<tr>
                <td>${e.date?.toDate().toLocaleDateString()}</td>
                <td><input class="inline-edit" value="${e.category}" onchange="dbUpdate('expenses','${d.id}','category',this.value)"></td>
                <td><input class="inline-edit" value="${e.note}" onchange="dbUpdate('expenses','${d.id}','note',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${e.amount}" onchange="dbUpdate('expenses','${d.id}','amount',this.value)"></td>
                <td><button onclick="deleteDoc(doc(db,'expenses','${d.id}'))">üóëÔ∏è</button></td></tr>`;
        });
        totals.expenses = ex; refreshDashboard();
    });

    // STAFF
    window.openStaffModal = () => document.getElementById('staff-modal').style.display = 'flex';
    window.saveStaff = async () => {
        await addDoc(collection(db,"staff"), {name: document.getElementById('staff-name').value, role: document.getElementById('staff-role').value, baseSalary: Number(document.getElementById('staff-salary').value), joinedDate: new Date()});
        closeModal('staff-modal');
    };
    onSnapshot(collection(db,"staff"), (snap) => {
        const l = document.getElementById('staff-list'); l.innerHTML = "";
        snap.forEach(d => {
            const s = d.data();
            l.innerHTML += `<tr>
                <td><input class="inline-edit" value="${s.name}" onchange="dbUpdate('staff','${d.id}','name',this.value)"></td>
                <td><input class="inline-edit" value="${s.role}" onchange="dbUpdate('staff','${d.id}','role',this.value)"></td>
                <td><input type="number" class="inline-edit" value="${s.baseSalary}" onchange="dbUpdate('staff','${d.id}','baseSalary',this.value)"></td>
                <td><button class="btn btn-p" style="padding:4px 8px" onclick="payStaff('${s.name}',${s.baseSalary})">Pay</button> <button onclick="deleteDoc(doc(db,'staff','${d.id}'))">üóëÔ∏è</button></td></tr>`;
        });
    });
    window.payStaff = async (n,a) => { if(confirm("Confirm Payment?")) await addDoc(collection(db,"expenses"), {category:"Salaries", amount:a, note:"Paid "+n, date:new Date()}); };

    // Auto-check on Page Load
    window.onload = () => {
        if(sessionStorage.getItem("ceelon_auth") === "true") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
        }
    };
</script>
</body>
</html>
