<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceelon Executive Suite</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --sidebar: #0f172a; --bg: #f8fafc; --accent: #2563eb; --success: #10b981; --danger: #ef4444; --text-main: #1e293b; --text-sub: #64748b; }
        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        aside { width: 280px; background: var(--sidebar); color: white; display: flex; flex-direction: column; padding: 1.5rem; flex-shrink: 0; border-right: 1px solid #e2e8f0; }
        .brand { font-size: 1.6rem; font-weight: 800; color: #38bdf8; margin-bottom: 2.5rem; display: flex; align-items: center; gap: 12px; }
        .nav-group { margin-bottom: 2rem; }
        .nav-label { font-size: 0.7rem; text-transform: uppercase; color: #475569; letter-spacing: 1px; margin-bottom: 10px; display: block; }
        .nav-link { padding: 12px 16px; color: #94a3b8; text-decoration: none; border-radius: 10px; margin-bottom: 4px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: #1e293b; color: white; }
        .nav-link.active { box-shadow: 0 4px 12px rgba(0,0,0,0.2); border-left: 4px solid #38bdf8; }

        /* MAIN AREA */
        main { flex: 1; overflow-y: auto; padding: 2rem; position: relative; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .page-title { margin: 0; font-size: 1.5rem; font-weight: 800; }

        /* CARDS & TABLES */
        .glass-card { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.06); border: 1px solid #f1f5f9; margin-bottom: 2rem; }
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 16px; border-bottom: 4px solid var(--accent); }
        .stat-card h4 { margin: 0; color: var(--text-sub); font-size: 0.75rem; text-transform: uppercase; }
        .stat-card .val { font-size: 1.5rem; font-weight: 800; margin-top: 8px; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f8fafc; color: var(--text-sub); font-size: 0.75rem; text-transform: uppercase; border-bottom: 2px solid #f1f5f9; }
        td { padding: 14px 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; }
        input.inline-edit { width: 100%; border: 1px solid transparent; padding: 6px; border-radius: 4px; font-size: 0.9rem; }
        input.inline-edit:hover { border-color: #cbd5e1; background: #f8fafc; }
        input.inline-edit:focus { outline: none; border-color: var(--accent); background: white; }

        /* BUTTONS */
        .btn { border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-p { background: var(--accent); color: white; }
        .btn-s { background: var(--success); color: white; }
        .btn-d { background: var(--danger); color: white; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* MODAL */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15,23,42,0.6); z-index:1000; justify-content:center; align-items:center; backdrop-filter: blur(4px); }
        .modal-content { background:white; padding:2rem; border-radius:20px; width:500px; max-height: 90vh; overflow-y: auto; }
        .form-group { margin-bottom: 1.2rem; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.85rem; color: var(--text-sub); }
        select, input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 10px; }

        .currency-toggle { background: #e2e8f0; padding: 4px; border-radius: 8px; display: flex; gap: 4px; }
        .curr-btn { border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 0.7rem; }
        .curr-btn.active { background: var(--accent); color: white; }
        /* --- RESPONSIVE MEDIA QUERIES --- */

/* Tablet & Smaller Screens (max-width: 1024px) */
@media (max-width: 1024px) {
    body { flex-direction: column; overflow-y: auto; height: auto; }
    
    aside {
        width: 100%;
        height: auto;
        padding: 1rem;
        border-right: none;
        border-bottom: 1px solid #1e293b;
    }

    .brand { margin-bottom: 1rem; }
    
    .nav-group { 
        display: flex; 
        overflow-x: auto; 
        gap: 8px; 
        margin-bottom: 1rem; 
        padding-bottom: 5px;
    }
    
    .nav-label { display: none; } /* Hide labels to save space */
    
    .nav-link { 
        white-space: nowrap; 
        margin-bottom: 0; 
        padding: 8px 12px; 
        font-size: 0.85rem;
    }

    aside div[style*="margin-top:auto"] {
        margin-top: 10px !important;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
    }

    main { padding: 1rem; overflow-y: visible; }

    .stat-grid { grid-template-columns: repeat(2, 1fr); }
}

/* Mobile Devices (max-width: 600px) */
@media (max-width: 600px) {
    .stat-grid { grid-template-columns: 1fr; gap: 1rem; }
    
    .top-bar { flex-direction: column; align-items: flex-start; gap: 1rem; }

    /* Make tables scrollable horizontally on small screens */
    .glass-card { overflow-x: auto; padding: 1rem; }
    
    table { min-width: 600px; } /* Ensures table content doesn't squish too much */

    .modal-content { width: 95%; margin: 10px; padding: 1.5rem; }

    .page-title { font-size: 1.2rem; }

    /* Fix for the Action buttons in mobile to be more tappable */
    .btn { padding: 12px; width: 100%; justify-content: center; }
    
    .nav-group { -webkit-overflow-scrolling: touch; }
}
    </style>
</head>
<body>

<aside>
    <div class="brand"><i class="fas fa-gem"></i> Ananmanan Databse/HR</div>
    
    <div class="nav-group">
        <span class="nav-label">Core Business</span>
        <div class="nav-link active" onclick="showPage('dash')"><i class="fas fa-chart-pie"></i> Financials</div>
        <div class="nav-link" onclick="showPage('products')"><i class="fas fa-tshirt"></i> Products Details</div>
        <div class="nav-link" onclick="showPage('sales')"><i class="fas fa-shopping-cart"></i> Sales Manager</div>
    </div>

    <div class="nav-group">
        <span class="nav-label">Operations</span>
        <div class="nav-link" onclick="showPage('expenses')"><i class="fas fa-wallet"></i> Expenses</div>
        <div class="nav-link" onclick="showPage('hr')"><i class="fas fa-users"></i> Employees & Salaries</div>
    </div>

    <div style="margin-top:auto; background: #1e293b; padding: 1rem; border-radius: 12px;">
        <small style="color:#94a3b8">Rate: 1 USD =</small>
        <input type="number" id="rate-input" value="310" onchange="updateRate()" style="background:none; border:none; color:#38bdf8; font-weight:800; font-size:1.2rem; width:80px; padding:0">
        <span style="font-size:0.8rem; color:white">LKR</span>
    </div>
</aside>

<main>
    <div class="top-bar">
        <h2 class="page-title" id="page-title-text">Business Intelligence</h2>
        <div class="currency-toggle">
            <button class="curr-btn active" id="btn-lkr" onclick="setMode('LKR')">LKR</button>
            <button class="curr-btn" id="btn-usd" onclick="setMode('USD')">USD</button>
        </div>
    </div>

    <div id="tab-dash">
        <div class="stat-grid">
            <div class="stat-card"><h4>Net Profit</h4><div class="val" id="f-profit" style="color:var(--success)">0</div></div>
            <div class="stat-card"><h4>Revenue</h4><div class="val" id="f-rev">0</div></div>
            <div class="stat-card"><h4>Stock Assets</h4><div class="val" id="f-stock">0</div></div>
            <div class="stat-card"><h4>Total Expenses</h4><div class="val" id="f-exp" style="color:var(--danger)">0</div></div>
        </div>
        <div class="glass-card">
            <h3>Profit Analysis</h3>
            <p style="color:var(--text-sub)">Real-time calculation of Sales - (Cost of Goods + Salaries + Expenses).</p>
        </div>
    </div>

    <div id="tab-products" style="display:none">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem">
                <h3>Product Specifications</h3>
                <button class="btn btn-p" onclick="addRow('products')"><i class="fas fa-plus"></i> New Product</button>
            </div>
            <table>
                <thead><tr><th>Name</th><th>Color/Size</th><th>Stock</th><th>Cost (LKR)</th><th>Retail (LKR)</th><th>Action</th></tr></thead>
                <tbody id="table-products"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-sales" style="display:none">
        <div class="btn-group" style="margin-bottom:2rem">
            <button class="btn btn-s" onclick="openSaleModal()"><i class="fas fa-cash-register"></i> New Sale Entry</button>
        </div>
        <div class="glass-card">
            <h3>Sales Ledger</h3>
            <table>
                <thead><tr><th>Date</th><th>Item</th><th>Base Price</th><th>Delivery/Extra</th><th>Total</th><th>Profit</th><th>Action</th></tr></thead>
                <tbody id="table-sales"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-expenses" style="display:none">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem">
                <h3>Business Expenses</h3>
                <button class="btn btn-d" onclick="addRow('expenses')"><i class="fas fa-plus"></i> Add Expense</button>
            </div>
            <table>
                <thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount (LKR)</th><th>Action</th></tr></thead>
                <tbody id="table-expenses"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-hr" style="display:none">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem">
                <h3>Employee Management</h3>
                <button class="btn btn-p" onclick="addRow('employees')"><i class="fas fa-user-plus"></i> Hire Employee</button>
            </div>
            <table>
                <thead><tr><th>Employee Name</th><th>Role</th><th>Monthly Salary</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="table-employees"></tbody>
            </table>
        </div>
    </div>
</main>

<div id="modal-sale" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">Manual Sale Entry</h3>
        <div class="form-group">
            <label>Select Product Variant</label>
            <select id="sale-item-idx"></select>
        </div>
        <div class="form-group">
            <label>Manual Delivery/Additional Charges (LKR)</label>
            <input type="number" id="sale-extra" value="0">
        </div>
        <div class="form-group">
            <label>Override Unit Price (LKR)</label>
            <input type="number" id="sale-price-override">
        </div>
        <div style="display:flex; gap:10px; margin-top:2rem">
            <button class="btn btn-p" style="flex:1; justify-content:center" onclick="confirmSale()">Process Sale</button>
            <button class="btn" style="flex:1; justify-content:center; background:#e2e8f0" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('ceelon_enterprise_v1')) || {
        products: [{ name: "Naruto", spec: "Black-M", qty: 10, cost: 4500, price: 7500 }],
        sales: [],
        expenses: [],
        employees: [],
        mode: 'LKR',
        rate: 310
    };

    function save() { localStorage.setItem('ceelon_enterprise_v1', JSON.stringify(db)); render(); }
    function setMode(m) { db.mode = m; save(); }
    function updateRate() { db.rate = parseFloat(document.getElementById('rate-input').value) || 310; save(); }
    function format(amt) {
        if (db.mode === 'USD') return '$' + (amt / db.rate).toFixed(2);
        return 'Rs. ' + amt.toLocaleString();
    }

    function render() {
        document.getElementById('btn-lkr').className = db.mode === 'LKR' ? 'curr-btn active' : 'curr-btn';
        document.getElementById('btn-usd').className = db.mode === 'USD' ? 'curr-btn active' : 'curr-btn';

        // Stats Calculation
        let rev = 0, stockVal = 0, expVal = 0, profit = 0;
        
        db.products.forEach(p => stockVal += (p.qty * p.cost));
        db.expenses.forEach(e => expVal += e.amount);
        db.employees.forEach(emp => expVal += emp.salary); // Salaries are treated as expenses
        db.sales.forEach(s => {
            rev += s.total;
            profit += s.profit;
        });

        document.getElementById('f-rev').innerText = format(rev);
        document.getElementById('f-stock').innerText = format(stockVal);
        document.getElementById('f-exp').innerText = format(expVal);
        document.getElementById('f-profit').innerText = format(profit - expVal);

        // Render Tables
        renderTable('products', 'table-products', (item, i) => `
            <tr>
                <td><input class="inline-edit" value="${item.name}" onchange="update('products', ${i}, 'name', this.value)"></td>
                <td><input class="inline-edit" value="${item.spec}" onchange="update('products', ${i}, 'spec', this.value)"></td>
                <td><input class="inline-edit" type="number" value="${item.qty}" onchange="update('products', ${i}, 'qty', this.value)"></td>
                <td><input class="inline-edit" type="number" value="${item.cost}" onchange="update('products', ${i}, 'cost', this.value)"></td>
                <td><input class="inline-edit" type="number" value="${item.price}" onchange="update('products', ${i}, 'price', this.value)"></td>
                <td><button onclick="remove('products', ${i})" style="color:var(--danger); border:none; background:none; cursor:pointer"><i class="fas fa-trash"></i></button></td>
            </tr>
        `);

        renderTable('sales', 'table-sales', (item, i) => `
            <tr>
                <td>${item.date}</td>
                <td>${item.desc}</td>
                <td>${format(item.base)}</td>
                <td>${format(item.extra)}</td>
                <td><strong>${format(item.total)}</strong></td>
                <td style="color:var(--success)">+${format(item.profit)}</td>
                <td><button onclick="remove('sales', ${i})" style="color:var(--danger); border:none; background:none; cursor:pointer"><i class="fas fa-undo"></i></button></td>
            </tr>
        `);

        renderTable('expenses', 'table-expenses', (item, i) => `
            <tr>
                <td><input class="inline-edit" type="date" value="${item.date}" onchange="update('expenses', ${i}, 'date', this.value)"></td>
                <td><input class="inline-edit" value="${item.cat}" onchange="update('expenses', ${i}, 'cat', this.value)"></td>
                <td><input class="inline-edit" value="${item.desc}" onchange="update('expenses', ${i}, 'desc', this.value)"></td>
                <td><input class="inline-edit" type="number" value="${item.amount}" onchange="update('expenses', ${i}, 'amount', this.value)"></td>
                <td><button onclick="remove('expenses', ${i})" style="color:var(--danger); border:none; background:none; cursor:pointer"><i class="fas fa-trash"></i></button></td>
            </tr>
        `);

        renderTable('employees', 'table-employees', (item, i) => `
            <tr>
                <td><input class="inline-edit" value="${item.name}" onchange="update('employees', ${i}, 'name', this.value)"></td>
                <td><input class="inline-edit" value="${item.role}" onchange="update('employees', ${i}, 'role', this.value)"></td>
                <td><input class="inline-edit" type="number" value="${item.salary}" onchange="update('employees', ${i}, 'salary', this.value)"></td>
                <td>Active</td>
                <td><button onclick="remove('employees', ${i})" style="color:var(--danger); border:none; background:none; cursor:pointer"><i class="fas fa-user-minus"></i></button></td>
            </tr>
        `);
    }

    function renderTable(key, id, template) {
        const container = document.getElementById(id);
        container.innerHTML = db[key].map(template).join('');
    }

    function update(key, i, field, val) {
        db[key][i][field] = (field === 'qty' || field === 'cost' || field === 'price' || field === 'amount' || field === 'salary') ? parseFloat(val) : val;
        save();
    }

    function addRow(key) {
        const models = {
            products: { name: "New Item", spec: "M-Black", qty: 0, cost: 0, price: 0 },
            expenses: { date: new Date().toISOString().split('T')[0], cat: "Marketing", desc: "Ads", amount: 0 },
            employees: { name: "New Name", role: "Sales", salary: 0 }
        };
        db[key].push(models[key]);
        save();
    }

    function remove(key, i) { if(confirm("Are you sure?")) { db[key].splice(i, 1); save(); } }

    function openSaleModal() {
        const sel = document.getElementById('sale-item-idx');
        sel.innerHTML = db.products.map((p, i) => `<option value="${i}">${p.name} (${p.spec}) - Stock: ${p.qty}</option>`).join('');
        document.getElementById('modal-sale').style.display = 'flex';
    }

    function confirmSale() {
        const pI = document.getElementById('sale-item-idx').value;
        const extra = parseFloat(document.getElementById('sale-extra').value) || 0;
        const p = db.products[pI];
        
        const priceUsed = parseFloat(document.getElementById('sale-price-override').value) || p.price;

        if (p.qty > 0) {
            p.qty--;
            const total = priceUsed + extra;
            const profit = priceUsed - p.cost; // Profit calculated only on the garment margin
            
            db.sales.push({
                date: new Date().toLocaleDateString(),
                desc: `${p.name} (${p.spec})`,
                base: priceUsed,
                extra: extra,
                total: total,
                profit: profit
            });
            save(); closeModal();
        } else { alert("Out of Stock!"); }
    }

    function showPage(page) {
        ['dash', 'products', 'sales', 'expenses', 'hr'].forEach(p => document.getElementById('tab-'+p).style.display = 'none');
        document.getElementById('tab-'+page).style.display = 'block';
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('page-title-text').innerText = event.currentTarget.innerText;
    }

    function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    window.onload = render;
</script>
</body>

</html>

